{"version":3,"file":null,"sources":["src/Annotation.js","src/AnnotationCollection.js","src/Adapter-d3.js","src/Types-d3.js","index.js"],"sourcesContent":["\nexport default class Annotation {\n  constructor({ x, y, dy, dx, text, title, data }) {\n    //super() calls parent's constructor\n\n    this.x = x || 0\n    this.y = y || 0\n    this.dx = dx || 0\n    this.dy = dy || 0\n    this.text = text\n    this.title = title\n    this.data = data || {}\n  }\n\n  get position() { return { x: this.x, y: this.y }}\n\n  set position({x, y}) {\n    this.x = x\n    this.y = y\n  }\n\n  get translation() {\n    return {\n    x: this.x + this.dx,\n    y: this.y + this.dy\n  }}\n\n  get json() { return {\n      x: this.x,\n      y: this.y,\n      dx: this.dx,\n      dy: this.dy,\n      text: this.text,\n      title: this.title,\n      data: this.data\n   }}\n}\n","export default class AnnotationCollection {\n\n  constructor({ annotations, accessors }) {\n    this.annotations = annotations\n    this.accessors = accessors\n  }\n\n  get json() {\n    return this.annotations.map(a => a.json)\n  }\n\n  // get annotations() {\n  //   return\n  // }\n}\n","// import { Annotation, AnnotationCollection } from 'viz-annotation'\nimport Annotation from './Annotation'\nimport AnnotationCollection from './AnnotationCollection'\n\nexport default function annotation(){\n  //declare internal variables\n  let annotations = [],\n    accessors= {},\n    editMode = false,\n    type= { draw: () => {} };\n\n  //drawing an annotation in d3\n  const annotation = function(selection){\n    const translatedAnnotations = annotations\n      .map(a => {\n        if (!a.x && a.data && accessors.x){ a.x = accessors.x(a.data) }\n        if (!a.y && a.data && accessors.y){ a.y = accessors.y(a.data) }\n        return new Annotation(a)\n      });\n\n\n    const collection = new AnnotationCollection ({\n      annotations: translatedAnnotations,\n      accessors\n    })\n\n    const annotationG = selection.selectAll('g').data([collection])\n    annotationG.enter().append('g').attr('class', 'annotations')\n\n    type.draw && type.draw(selection.select('g.annotations'), collection, editMode)\n  }\n\n  //TODO: add in classprefix functionality\n  annotation.type = function(_) {\n    if (!arguments.length) return type;\n    type = _;\n    return annotation;\n  }\n\n  annotation.annotations = function(_) {\n    if (!arguments.length) return annotations;\n    annotations = _\n    return annotation;\n  };\n\n  annotation.accessors = function(_) {\n    if (!arguments.length) return accessors;\n    accessors = _;\n    return annotation\n  }\n\n  annotation.editMode = function(_) {\n    if (!arguments.length) return editMode;\n    editMode = _\n    return annotation\n  }\n\n  return annotation;\n\n};\n","import { select } from 'd3-selection'\n\nconst drawEach = (group, collection) => {\n  console.log('collection', collection, group)\n  group.selectAll('g.annotation')\n  .data(collection.annotations)\n  // console.log('annotations', group, collection, collection.annotations)\n  // console.log('group data',annotations, annotations.data())\n\n  .enter()\n  .append('g')\n  .attr('class', 'annotation')\n  .attr('transform', d => {\n    console.log('d', d)\n    const translation = d.translation\n    return `translate(${translation.x}, ${translation.y})`\n  })\n\n  return group\n}\n\nconst draggable = () => {\n\n}\n\nconst drawText = (a, d) => {\n  const text = a.selectAll('.annotation-text')\n    .data([d])\n\n  text.enter()\n  .append('text')\n  .attr('class', 'annotation-text')\n\n  text.text(d => d.text)\n\n  const bbox = text.node().getBBox();\n\n  // a.select('text.annotation-text')\n  // .attr('y', d => {\n  //   if (d.dy && d.dy > 0) {\n  //     return 5 + bbox.height\n  //   }\n  //   return -10\n  // })\n\n  return bbox\n}\n\nconst drawConnectorLine = () => {\n\n}\n\n//TODO\n//const drawConnectorElbow = () => {}\n\nconst d3Callout = {\n  draw: (g, collection, editMode) => {\n    const group = drawEach(g, collection)\n\n    group.each(function(d)  {\n      console.log(select)\n      const a = select(this)\n      const textBBox = drawText(a, d)\n      // drawUnderline(a, textBBox)\n      // drawAnnotationLine(a, textBBox)\n\n    })\n\n    // if (editMode) {\n    //   group.call(draggable)\n    // }\n\n  }\n\n}\n\nexport default {\n  d3Callout\n}\n","import annotation from './src/Adapter-d3'\nimport types from './src/Types-d3'\n\nexport default {\n  annotation,\n  annotationCallout : types.d3Callout\n}\n"],"names":["Annotation","x","y","dy","dx","text","title","data","AnnotationCollection","annotations","accessors","map","a","json","annotation","editMode","type","draw","selection","translatedAnnotations","collection","annotationG","selectAll","enter","append","attr","select","_","arguments","length","drawEach","group","console","log","d","translation","drawText","bbox","node","getBBox","d3Callout","g","each","textBBox","annotationCallout","types"],"mappings":"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"}